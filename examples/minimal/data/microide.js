const filesObj=document.getElementById("files"),contentObj=document.getElementById("content"),progressObj=document.getElementById("progress"),activeFileObj=document.getElementById("activeFile"),checkerObj=document.getElementById("checker");let activeFileName;function handleLoadFile(e){const t=e.target.innerText;activeFileName=t.split(" ")[0],activeFileObj.innerText=activeFileName,fetch(activeFileName).then((function(e){return e.text()})).then((function(e){contentObj.innerText=e}))}function DelayPromise(e){return new Promise((function(t){setTimeout(t,e)}))}function handleDeleteFile(e){e.stopPropagation(),e.preventDefault();let t=e.target.parentElement.firstElementChild.innerText;t=t.split(" ")[0];window.confirm("Delete "+t+" ?")&&(fetch(t,{method:"DELETE"}),window.setTimeout(handleReloadFS,100))}function addFileEntry(e,t){const n=createHTMLElement(e,"div",{class:"row nogutter"});n.addEventListener("click",handleLoadFile);const o=createHTMLElement(n,"div",{class:"col stretch file-entry"});o.innerText=o.title=t.name+" ("+t.size+")";const a=createHTMLElement(n,"div",{class:"col file-delete"});a.innerText="[X]",a.addEventListener("click",handleDeleteFile)}function listFiles(e){filesObj.innerHTML="",e.forEach((function(e){addFileEntry(filesObj,e)}))}function handleReloadFS(){fetch("/$list").then((function(e){return e.json()})).then((function(e){e.sort((function(e,t){const n=e.name.toLowerCase(),o=t.name.toLowerCase();return n<o?-1:n>o?1:0})),listFiles(e)}))}function dragHelper(e){e.stopPropagation(),e.preventDefault()}function startUpload(e,t,n){progressObj.classList.remove("fadeout");const o=new FormData,a=new Blob([n],{type:t});o.append(e,a,e);const i=new XMLHttpRequest;i.open("POST","/"),i.upload&&i.upload.addEventListener("progress",(function(e){progressObj.max=e.total,progressObj.value=e.loaded})),i.addEventListener("readystatechange",(function(e){4===i.readyState&&i.status>=200&&i.status<300&&(window.setTimeout(handleReloadFS,200),progressObj.classList.add("fadeout"))})),i.send(o)}function handleSave(){progressObj.value=0,progressObj.max=1,activeFileName=window.prompt("Upload File:",activeFileName),void 0!==activeFileName&&startUpload(activeFileName,"text/html",contentObj.innerText)}function handleFmt(){if(activeFileObj.innerText.toLowerCase().endsWith(".json")){let e=contentObj.innerText,t=null;e=e.replace(/\}\s*\{/g,"},{"),e=e.replace(/,\s*([}\]])/g,"$1");try{t=JSON.parse(e),t&&"object"==typeof t&&(contentObj.innerText=JSON.stringify(t,null,2))}finally{}}}function drop(e){progressObj.classList.remove("fadeout"),progressObj.value=0,progressObj.max=1,e.stopPropagation(),e.preventDefault();const t=e.dataTransfer.files,n=new FormData,o="/"+(location.hash?location.hash.substring(1)+"/":"");for(let e=0;e<t.length;e++)n.append("file",t[e],o+t[e].name);const a=new XMLHttpRequest;a.upload.addEventListener("progress",(function(e){progressObj.max=e.total,progressObj.value=e.loaded})),a.addEventListener("readystatechange",(function(e){4===a.readyState&&a.status>=200&&a.status<300&&(window.setTimeout(handleReloadFS,100),progressObj.classList.add("fadeout"))})),a.open("POST","/"),a.send(n)}contentObj.addEventListener("paste",(function(e){const t=window.getSelection();if(t.rangeCount){const n=e.clipboardData.getData("text/plain");t.deleteFromDocument(),t.getRangeAt(0).insertNode(document.createTextNode(n)),t.collapseToEnd(),e.preventDefault()}}));const box=document.getElementById("dropzone");function jsonCheck(){if(activeFileObj.innerText.toLowerCase().endsWith(".json")){let e=null,t=contentObj.innerText;t.indexOf("Â ")>=0&&(contentObj.innerText=t=t.replace(/\u00A0/g," "));try{e=JSON.parse(t),e&&"object"==typeof e||(e=null)}catch(e){checkerObj.title=e.message}null!==e?(checkerObj.textContent="ok",checkerObj.className="valid",checkerObj.title=""):(checkerObj.textContent="no",checkerObj.className="invalid"),window.status=t.length+"--"+(null!==e)}else"--"!=checkerObj.textContent&&(checkerObj.textContent="--",checkerObj.className="")}box.addEventListener("dragenter",dragHelper,!1),box.addEventListener("dragover",dragHelper,!1),box.addEventListener("drop",drop,!1),window.addEventListener("DOMContentLoaded",handleReloadFS),window.setInterval(jsonCheck,500);
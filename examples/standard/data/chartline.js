var panelObj=document.getElementById("panel"),backObj=document.getElementById("background"),indObj=document.getElementById("ind"),redrawTimer=null,REGION_WIDTH=128,REGION_HEIGHT=36;function _calcSteps(t,e){var n=e-t,i=Math.pow(10,Math.floor(Math.log10(n))),a={},i=n<=2*i?i/2:n<=5*i?i:2*i;return a.high=Math.ceil(e/i)*i,a.low=Math.floor(t/i)*i,a.step=i,a}var graphs=[],minBox={left:1/0,right:-1/0,minY:0,maxY:1},displayBox=minBox;function fmtData(t,e){var n=e,i=t.split(":"),e=Number(e);return"num"==i[0]?n=String(e.toFixed(i[1]||0)):"date"==t?n=new Date(1e3*e).toLocaleDateString():"time"==t?n=new Date(1e3*e).toLocaleTimeString():"datetime"==t&&(n=new Date(1e3*e).toLocaleString()),n}function outerBox(t,e){var n=t;return t?e&&(n={left:Math.min(t.left,e.left),right:Math.max(t.right,e.right),minY:Math.min(t.minY,e.minY),maxY:Math.max(t.maxY,e.maxY)}):n=e,n}function boxEqual(t,e){return t.minY===e.minY&&t.maxY===e.maxY&&t.left===e.left&&t.right===e.right}function redraw(){var t=graphs.reduce(function(t,e){return e.fBox(t)},null),e=!boxEqual(t,displayBox);displayBox=t,graphs.forEach(function(t){(e||t.redraw)&&(t.fDraw(displayBox),t.redraw=!1)}),redrawTimer=null}function _startRedraw(){redrawTimer=redrawTimer||window.setTimeout(redraw,20)}ChartLineClass=function(f){return{type:"line",redraw:!1,data:null,options:Object.assign({},{linetype:"line",color:"black"},f),svgObj:null,_calcBox:function(t){var e,n=null;return t&&(e=t.map(function(t){return t.x}),t=t.map(function(t){return t.y}),n={left:Math.min(...e),right:Math.max(...e),minY:Math.min(...t),maxY:Math.max(...t)}),n},draw:function(t){this.data=t,this.box=this._calcBox(t),this.redraw=!0,_startRedraw()},clear:function(){this.svgObj&&this.svgObj.remove()},fBox:function(t){return outerBox(t,this.box)},fDraw:function(i){this.svgObj&&this.svgObj.remove();var t=this.data;if(t){var a=128/(i.right-i.left),r=REGION_HEIGHT/(i.maxY-i.minY),e=[];if("steps"==this.options.linetype)(e=t.map(function(t,e){return"H"+(t.x-i.left)*a+" V"+(t.y-i.minY)*r}))[0]="M"+(t[0].x-i.left)*a+","+(t[0].y-i.minY)*r;else if("line"==this.options.linetype)e=t.map(function(t,e){return(0<e?"L":"M")+(t.x-i.left)*a+","+(t.y-i.minY)*r});else if("bezier"==this.options.linetype){var o=t.map(function(t){return{x:(t.x-i.left)*a,y:(t.y-i.minY)*r}}),s=(i.right-i.left)/t.length/2*a,l=[];for(l.push({dx:0,dy:0}),n=1;n<t.length-1;n++){var c=o[n+1].x-o[n-1].x,h=o[n+1].y-o[n-1].y,u=Math.sqrt(c*c+h*h);l.push({dx:s*c/u,dy:s*h/u})}for(l.push({dx:0,dy:0}),e.push("M"+o[0].x+","+o[0].y),n=0;n<t.length-1;n++)e.push("C"+(o[n].x+l[n].dx)+","+(o[n].y+l[n].dy)+" "+(o[n+1].x-l[n+1].dx)+","+(o[n+1].y-l[n+1].dy)+" "+o[n+1].x+","+o[n+1].y)}var d={class:"chartline",style:"stroke:"+this.options.color,d:e.join("")};f.marker&&(d.style+=";marker:url(#circle)"),this.svgObj=createSVGNode(panelObj,"path",d)}}}},HLineClass=function(t){return{type:"hLine",data:(t=Object.assign({data:0,color:"black"},t)).data,color:t.color,redraw:!0,svgObj:null,fBox:function(t){return t&&(t.minY=Math.min(this.data,t.minY),t.maxY=Math.max(this.data,t.maxY)),t},fDraw:function(t){this.clear();var e=REGION_HEIGHT/(t.maxY-t.minY),e=(this.data-t.minY)*e;this.svgObj=createSVGNode(panelObj,"line",{class:"hline",style:"stroke:"+this.color,x1:0,y1:e,x2:128,y2:e}),this.redraw=!1},clear:function(){this.svgObj&&this.svgObj.remove(),this.redraw=!0}}},VAxisClass=function(){return{type:"vAxis",redraw:!0,svgObj:document.querySelector("#v-labels"),fBox:function(t){var e;return t&&(e=_calcSteps(t.minY,t.maxY),t.minY=e.low,t.maxY=e.high,this.step=e.step),t},fDraw:function(t){this.clear();for(var e=t.maxY,n=t.minY,i=this.step,a=i<1?String(i).length-2:0,r=REGION_HEIGHT/(e-n),o=n;o<=e;o+=i)createSVGNode(this.svgObj,"text",{x:11,y:-1*(o-n)*r},String(Number(o).toFixed(a)));this.redraw=!1},clear:function(){_removeChilds(this.svgObj),this.redraw=!0}}},HAxisClass=function(t){return{type:"hAxis",redraw:!0,options:Object.assign({format:"num",color:"black"},t),svgObj:document.querySelector("#h-labels"),fBox:function(t){var e;return t&&(e=_calcSteps(t.left,t.right),t.left=e.low,t.right=e.high,this.step=e.step),t},fDraw:function(t){this.clear();var e=t.right,n=t.left;if(isFinite(n)&&isFinite(e)){var i=this.step,t=i<1?String(i).length-2:0,a=REGION_WIDTH/(e-n);"num"===this.options.format&&0;for(var r=n;r<=e;r+=i){var o=fmtData(this.options.format,r).split(",");createSVGNode(this.svgObj,"text",{x:(r-n)*a,y:0,style:"fill:"+this.options.color},o[0]),o[1]&&createSVGNode(this.svgObj,"text",{x:(r-n)*a,y:3,style:"fill:"+this.options.color},o[1])}}this.redraw=!1},clear:function(){_removeChilds(this.svgObj),this.redraw=!0}}},IndicatorClass=function(t){return{type:"indicator",redraw:!1,svgObj:document.querySelector("#ind"),options:Object.assign({xFormat:"num",yFormat:"num"},t),fBox:function(t){return t},fDraw:function(t){},clear:function(){},_setIndicator:function(t,e){indObj.style.display="";var n=indObj.querySelector("line"),i=indObj.querySelector("circle"),a=indObj.querySelector(".info"),r=(e.x-t.left)*REGION_WIDTH/(t.right-t.left),t=(e.y-t.minY)*(REGION_HEIGHT/(t.maxY-t.minY));n.x1.baseVal.value=n.x2.baseVal.value=r,i.cx.baseVal.value=r,i.cy.baseVal.value=t,a.setAttribute("transform","translate("+(r+=r<REGION_WIDTH/2?2:-20)+","+(t+=t<REGION_HEIGHT/2?1:-11)+")");a=a.querySelectorAll("text");a[0].textContent=fmtData(this.options.yFormat,e.y);e=fmtData(this.options.xFormat,e.x).split(",");a[1].textContent=e[0],a[2].textContent=e[1]},display:function(t){var e,n=eventPoint(t),i=graphs[0];!i||(t=i.data)&&t.length&&(i=i.box,e=i.left+(n.x-12)*(i.right-i.left)/REGION_WIDTH,(i=t.findIndex(function(t){return t.x>e}))<0?i=t.length-1:0<i&&t[i].x-e>e-t[i-1].x&&(i-=1),this._setIndicator(displayBox,t[i]))}}};var indicator=null;panelObj.addEventListener("mouseout",function(){indObj.style.display="none"}),panelObj.addEventListener("mousemove",function(t){indicator&&indicator.display(t)}),document.api={options:{},setOptions:function(t){},add:function(t,e){var n,i=-1,a=!1;return Array.isArray(t)?t.forEach(this.add.bind(this)):"object"==typeof t?this.add(t.type,t.options):(t=t.toLowerCase(),e=Object.assign({},e),"line"===t?(n=new ChartLineClass(e),a=!0):"hline"==t?n=new HLineClass(e):"vaxis"==t?n=new VAxisClass:"haxis"==t?n=new HAxisClass(e):"indicator"==t&&(n=new IndicatorClass(e),indicator=n),n&&(a?(i=Math.max(0,graphs.findIndex(function(t){return"line"==t.type})),graphs.splice(i,0,n)):i=graphs.push(n)-1)),i},draw:function(t,e){t=graphs[t]||graphs[0];t&&"line"===t.type&&t.draw(e)},clear:function(){graphs.forEach(function(t){t.clear()}),graphs=[],indicator=null},_defaultOptions:{}};
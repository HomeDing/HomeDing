var panelObj=document.getElementById("panel"),backObj=document.getElementById("background"),indObj=document.getElementById("ind"),redrawTimer=null,REGION_WIDTH=128,REGION_HEIGHT=36;function _calcSteps(t,e){var n=e-t,a=Math.pow(10,Math.floor(Math.log10(n))),r={},a=n<=2*a?a/2:n<=5*a?a:2*a;return r.high=Math.ceil(e/a)*a,r.low=Math.floor(t/a)*a,r.step=a,r}var graphs=[],minBox={left:1/0,right:-1/0,minY:0,maxY:1},displayBox=minBox;function fmtDate(t){return new Date(1e3*Number(t)).toLocaleDateString()}function fmtTime(t){return new Date(1e3*Number(t)).toLocaleTimeString()}function outerBox(t,e){var n=t;return n?e&&(n={left:Math.min(t.left,e.left),right:Math.max(t.right,e.right),minY:Math.min(t.minY,e.minY),maxY:Math.max(t.maxY,e.maxY)}):n=e,n}function boxEqual(t,e){return t.minY===e.minY&&t.maxY===e.maxY&&t.left===e.left&&t.right===e.right}function calcOuterBox(t,e){return t=e.fBox?e.fBox(t,e):outerBox(t,e.box)}function addVAxis(){var t=new VAxisClass;return graphs.push(t)-1}function _addHAxis(){var t=new HAxisClass;return graphs.push(t)-1}function redraw(){var t=graphs.reduce(calcOuterBox,null),e=!boxEqual(t,displayBox);displayBox=t,graphs.forEach(function(t){(e||t.redraw)&&(t.fDraw(displayBox),t.redraw=!1)}),redrawTimer=null}function _startRedraw(){redrawTimer=redrawTimer||window.setTimeout(redraw,20)}function _clear(){graphs.forEach(function(t){t.clear&&t.clear()}),graphs=[]}function setIndicator(t,e){var n,a,r,i;t&&e&&(indObj.style.display="",n=indObj.querySelector("line"),a=indObj.querySelector("circle"),i=indObj.querySelector(".info"),r=(e.x-t.left)*REGION_WIDTH/(t.right-t.left),t=(e.y-t.minY)*(REGION_HEIGHT/(t.maxY-t.minY)),n.x1.baseVal.value=n.x2.baseVal.value=r,a.cx.baseVal.value=r,a.cy.baseVal.value=t,r+=r<REGION_WIDTH/2?2:-20,t+=t<REGION_HEIGHT/2?2:-12,i.setAttribute("transform","translate("+r+","+t+")"),(i=i.querySelectorAll("text"))[0].textContent=e.y,i[1].textContent=fmtDate(e.x),i[2].textContent=fmtTime(e.x))}function clearIndicator(){indObj.style.display="none"}function _addChart(t,e){var n,a=-1,r=!1;return t=t.toLowerCase(),e=Object.assign({},e),"line"===t?(n=new LineChartClass(e),r=!0):"hline"==t&&(n=new HLineClass(e)),n&&(r?(a=Math.max(0,graphs.findIndex(function(t){return"line"==t.type})),graphs.splice(a,0,n)):a=graphs.push(n)-1),a}function _add(t){}LineChartClass=function(t){return{type:"line",data:null,linetype:(t=Object.assign({linetype:"line",color:"black"},t)).linetype,color:t.color,redraw:!1,svgObj:null,_calcBox:function(t){var e,n=null;return t&&(e=t.map(function(t){return t.x}),t=t.map(function(t){return t.y}),n={left:Math.min(...e),right:Math.max(...e),minY:Math.min(...t),maxY:Math.max(...t)}),n},draw:function(t){this.data=t,this.box=this._calcBox(t),this.redraw=!0,_startRedraw()},clear:function(){this.svgObj&&this.svgObj.remove()},fBox:null,XfBox:function(t,e){return t&&(t.minY=Math.min(y,t.minY),t.maxY=Math.max(y,t.maxY)),t},fDraw:function(n){this.svgObj&&this.svgObj.remove();var a,r,t,e=this.data;e&&(a=128/(n.right-n.left),r=REGION_HEIGHT/(n.maxY-n.minY),"steps"==this.linetype?(t=e.map(function(t,e){return"H"+(t.x-n.left)*a+" V"+(t.y-n.minY)*r}))[0]="M"+(e[0].x-n.left)*a+","+(e[0].y-n.minY)*r:"line"==this.linetype&&(t=e.map(function(t,e){return(0<e?"L":"M")+(t.x-n.left)*a+","+(t.y-n.minY)*r})),this.svgObj=createSVGNode(panelObj,"path",{class:"linechart",style:"stroke:"+this.color,d:t.join(" ")}))}}},HLineClass=function(t){return{type:"hLine",data:(t=Object.assign({data:0,color:"black"},t)).data,color:t.color,redraw:!1,svgObj:null,fBox:function(t,e){return t&&(t.minY=Math.min(this.data,t.minY),t.maxY=Math.max(this.data,t.maxY)),t},fDraw:function(t){this.svgObj&&this.svgObj.remove();var e=REGION_HEIGHT/(t.maxY-t.minY),e=(this.data-t.minY)*e;this.svgObj=createSVGNode(panelObj,"line",{class:"hline",style:"stroke:"+this.color,x1:0,y1:e,x2:128,y2:e})}}},VAxisClass=function(){return{type:"vAxis",data:null,redraw:!1,svgObj:null,fBox:function(t,e){var n;return t&&(n=_calcSteps(t.minY,t.maxY),Object.assign(t,{minY:n.low,maxY:n.high}),Object.assign(e,n)),t},fDraw:function(t){var e=document.getElementById("v-labels");_removeChilds(e);for(var n=t.maxY,a=t.minY,r=this.step,i=r<1?String(r).length-2:0,l=REGION_HEIGHT/(n-a),o=a;o<=n;o+=r)createSVGNode(e,"text",{x:11,y:-1*(o-a)*l},String(o.toFixed(i)))}}},HAxisClass=function(){return{type:"hAxis",data:null,redraw:!1,svgObj:null,fBox:null,fDraw:function(t){var e=document.getElementById("h-labels");_removeChilds(e);var n=t.right,t=t.left;isFinite(t)&&isFinite(n)&&(t=t+Math.floor((n-t)/2),createSVGNode(e,"text",{x:REGION_WIDTH/2,y:0},fmtTime(t)))}}},panelObj.addEventListener("mouseout",clearIndicator),panelObj.addEventListener("mousemove",function(t){var e,n=eventPoint(t),a=graphs[0];!a||(t=a.data)&&t.length&&(a=a.box,e=a.left+(n.x-12)*(a.right-a.left)/REGION_WIDTH,0<(a=t.findIndex(function(t){return t.x>e}))&&t[a].x-e>e-t[a-1].x&&--a,setIndicator(displayBox,t[a]))}),document.api={clear:_clear,add:_add,addChart:_addChart,draw:function(t,e){t=graphs[t]||graphs[0];t&&"line"===t.type&&t.draw(e)},addVAxis:addVAxis,addHAxis:_addHAxis,options:{}};
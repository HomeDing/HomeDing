var panelObj=document.getElementById("panel"),backObj=document.getElementById("background"),indObj=document.getElementById("ind"),redrawTimer=null,REGION_WIDTH=128,REGION_HEIGHT=36;function _calcSteps(t,e){var i,n=e-t,a=Math.pow(10,Math.floor(Math.log10(n))),r={};return i=n<=2*a?a/2:n<=5*a?a:2*a,r.high=Math.ceil(e/i)*i,r.low=Math.floor(t/i)*i,r.step=i,r}function _calcDateSteps(t,e){const i=86400,n=60*new Date(0).getTimezoneOffset();var a,r={},s=e-t;if(s>43200&&s<i)a=21600;else if(s>i&&s<2*i)a=43200;else if(s>2*i&&s<6*i)a=i;else{if(!(s>6*i&&s<14*i))return _calcSteps(t,e);a=2*i}return r.high=Math.ceil(e/a)*a-n,r.low=Math.floor(t/a)*a+n,r.step=a,r}var graphs=[],minBox={left:1/0,right:-1/0,minY:0,maxY:1},displayBox=minBox;function fmtData(t,e){var i=e,n=t.split(":"),a=Number(e);return"num"==n[0]?i=String(a.toFixed(n[1]||0)):"date"==t?i=new Date(1e3*a).toLocaleDateString("de"):"time"==t?i=new Date(1e3*a).toLocaleTimeString("de"):"datetime"==t&&(i=new Date(1e3*a).toLocaleString("de")),i}function outerBox(t,e){var i=t;return i?e&&(i={left:Math.min(t.left,e.left),right:Math.max(t.right,e.right),minY:Math.min(t.minY,e.minY),maxY:Math.max(t.maxY,e.maxY)}):i=e,i}function boxEqual(t,e){return t.minY===e.minY&&t.maxY===e.maxY&&t.left===e.left&&t.right===e.right}var ChartLineClass=function(t){return{type:"line",redraw:!1,data:null,options:Object.assign({},{linetype:"line",color:"black"},t),svgObj:null,_calcBox:function(t){var e=null;if(t){var i=t.map((function(t){return t.x})),n=t.map((function(t){return t.y}));e={left:Math.min(...i),right:Math.max(...i),minY:Math.min(...n),maxY:Math.max(...n)}}return e},draw:function(t){this.data=t,this.box=this._calcBox(t),this.redraw=!0,_startRedraw()},clear:function(){this.svgObj&&this.svgObj.remove()},fBox:function(t){return outerBox(t,this.box)},fDraw:function(e){this.svgObj&&this.svgObj.remove();var i=this.data;if(i){var n=128/(e.right-e.left),a=REGION_HEIGHT/(e.maxY-e.minY),r=[];if("steps"==this.options.linetype)r=i.map((t=>"H"+(t.x-e.left)*n+" V"+(t.y-e.minY)*a)),r[0]="M"+(i[0].x-e.left)*n+","+(i[0].y-e.minY)*a;else if("line"==this.options.linetype)r=i.map(((t,i)=>(i>0?"L":"M")+(t.x-e.left)*n+","+(t.y-e.minY)*a));else if("bezier"==this.options.linetype){var s=i.map((t=>({x:(t.x-e.left)*n,y:(t.y-e.minY)*a})));const t=i.length;var o=(e.right-e.left)/t/2*n,l=[];l.push({dx:0,dy:0});for(let e=1;e<t-1;e++){var c=s[e+1].x-s[e-1].x,h=s[e+1].y-s[e-1].y,u=Math.sqrt(c*c+h*h);l.push({dx:o*c/u,dy:o*h/u})}l.push({dx:0,dy:0}),r.push("M"+s[0].x+","+s[0].y);for(let e=0;e<t-1;e++)r.push("C"+(s[e].x+l[e].dx)+","+(s[e].y+l[e].dy)+" "+(s[e+1].x-l[e+1].dx)+","+(s[e+1].y-l[e+1].dy)+" "+s[e+1].x+","+s[e+1].y)}var d={class:"chartline",style:"stroke:"+this.options.color,d:r.join("")};t.marker&&(d.style+=";marker:url(#circle)"),this.svgObj=createSVGNode(panelObj,"path",d)}}}};function redraw(){var t=graphs.reduce((function(t,e){return e.fBox(t)}),null),e=!boxEqual(t,displayBox);displayBox=t,graphs.forEach((function(t){(e||t.redraw)&&(t.fDraw(displayBox),t.redraw=!1)})),redrawTimer=null}function _startRedraw(){redrawTimer||(redrawTimer=window.setTimeout(redraw,20))}HLineClass=function(t){return{type:"hLine",data:(t=Object.assign({data:0,color:"black"},t)).data,color:t.color,redraw:!0,svgObj:null,fBox:function(t){return t&&(t.minY=Math.min(this.data,t.minY),t.maxY=Math.max(this.data,t.maxY)),t},fDraw:function(t){this.clear();var e=REGION_HEIGHT/(t.maxY-t.minY),i=(this.data-t.minY)*e;this.svgObj=createSVGNode(panelObj,"line",{class:"hline",style:"stroke:"+this.color,x1:0,y1:i,x2:128,y2:i}),this.redraw=!1},clear:function(){this.svgObj&&this.svgObj.remove(),this.redraw=!0}}},VAxisClass=function(){return{type:"vAxis",redraw:!0,svgObj:document.querySelector("#v-labels"),fBox:function(t){if(t){var e=_calcSteps(t.minY,t.maxY);t.minY=e.low,t.maxY=e.high,this.step=e.step}return t},fDraw:function(t){this.clear();for(var e=t.maxY,i=t.minY,n=this.step,a=n<1?String(n).length-2:0,r=REGION_HEIGHT/(e-i),s=i;s<=e;s+=n)createSVGNode(this.svgObj,"text",{x:11,y:-1*(s-i)*r},String(Number(s).toFixed(a)));this.redraw=!1},clear:function(){_removeChilds(this.svgObj),this.redraw=!0}}},HAxisClass=function(t){return{type:"hAxis",redraw:!0,options:Object.assign({format:"num",color:"black"},t),svgObj:document.querySelector("#h-labels"),fBox:function(t){if(t){var e=_calcDateSteps(t.left,t.right);t.left=e.low,t.right=e.high,this.step=e.step}return t},fDraw:function(t){this.clear();var e=t.right,i=t.left;if(isFinite(i)&&isFinite(e)){var n=this.step,a=n<1?String(n).length-2:0,r=REGION_WIDTH/(e-i),s=this.options.format;"num"===s&&(s="num:"+a);for(var o=i;o<=e;o+=n){var l=fmtData(this.options.format,o).split(",");createSVGNode(this.svgObj,"text",{x:(o-i)*r,y:0,style:"fill:"+this.options.color},l[0]),l[1]&&createSVGNode(this.svgObj,"text",{x:(o-i)*r,y:3,style:"fill:"+this.options.color},l[1])}}this.redraw=!1},clear:function(){_removeChilds(this.svgObj),this.redraw=!0}}},IndicatorClass=function(t){return{type:"indicator",redraw:!1,svgObj:document.querySelector("#ind"),options:Object.assign({xFormat:"num",yFormat:"num"},t),fBox:function(t){return t},fDraw:function(t){},clear:function(){},_setIndicator:function(t,e){indObj.style.display="";var i=indObj.querySelector("line"),n=indObj.querySelector("circle"),a=indObj.querySelector(".info"),r=(e.x-t.left)*REGION_WIDTH/(t.right-t.left),s=(e.y-t.minY)*(REGION_HEIGHT/(t.maxY-t.minY));i.x1.baseVal.value=i.x2.baseVal.value=r,n.cx.baseVal.value=r,n.cy.baseVal.value=s,r+=r<REGION_WIDTH/2?2:-20,s+=s<REGION_HEIGHT/2?1:-11,a.setAttribute("transform","translate("+r+","+s+")");var o=a.querySelectorAll("text");o[0].textContent=fmtData(this.options.yFormat,e.y);var l=fmtData(this.options.xFormat,e.x).split(",");o[1].textContent=l[0],o[2].textContent=l[1]},display:function(t){var e=eventPoint(t),i=graphs[0];if(i){var n=i.data;if(n&&n.length){var a=i.box,r=a.left+(e.x-12)*(a.right-a.left)/REGION_WIDTH,s=n.findIndex((function(t){return t.x>r}));s<0?s=n.length-1:s>0&&n[s].x-r>r-n[s-1].x&&(s-=1),this._setIndicator(displayBox,n[s])}}}}};var indicator=null;panelObj.addEventListener("mouseout",(function(){indObj.style.display="none"})),panelObj.addEventListener("mousemove",(function(t){indicator&&indicator.display(t)})),document.api={options:{},setOptions:function(t){},add:function(t,e){var i,n=-1,a=!1;return Array.isArray(t)?t.forEach(this.add.bind(this)):"object"==typeof t?this.add(t.type,t.options):(t=t.toLowerCase(),e=Object.assign({},e),"line"===t?(i=new ChartLineClass(e),a=!0):"hline"==t?i=new HLineClass(e):"vaxis"==t?i=new VAxisClass:"haxis"==t?i=new HAxisClass(e):"indicator"==t&&(i=new IndicatorClass(e),indicator=i),i&&(a?(n=Math.max(0,graphs.findIndex((function(t){return"line"==t.type}))),graphs.splice(n,0,i)):n=graphs.push(i)-1)),n},draw:function(t,e){var i=graphs[t]||graphs[0];i&&"line"===i.type&&i.draw(e)},clear:function(){graphs.forEach((function(t){t.clear()})),graphs=[],indicator=null},_defaultOptions:{}};
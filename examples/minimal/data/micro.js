"use strict";var MicroState,__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,n){var o,s=arguments.length,r=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;0<=a;a--)(o=t[a])&&(r=(s<3?o(r):3<s?o(e,i,r):o(e,i))||r);return 3<s&&r&&Object.defineProperty(e,i,r),r},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};!function(t){t[t.PREP=1]="PREP",t[t.INIT=2]="INIT",t[t.LOADED=3]="LOADED"}(MicroState=MicroState||{});var MicroRegistry=function(){function t(){this._tco=null,this._registry={},this._state=MicroState.PREP,this._unloadedList=[],this.List=[],window.addEventListener("load",this.init.bind(this)),window.addEventListener("unload",this.onunload.bind(this))}return t.prototype.init=function(){if(this._state=MicroState.INIT,this._tco=document.getElementById("u-templates"),!this._tco){var t=document.createElement("div");t.id="u-templates",this._tco=document.body.appendChild(t)}"complete"===document.readyState?this.init2():document.addEventListener("readystatechange",this.init2)},t.prototype.init2=function(){var n=this;"complete"===document.readyState&&(this._state=MicroState.LOADED,this._unloadedList.forEach(function(t){var e=t.getAttribute("u-is");if(e){var i=n._registry[e];i&&n.loadBehavior(t,i),n.List.push(t)}}),this._unloadedList=[])},t.prototype.loadFile=function(t){var i=this;return fetch(t).then(function(t){return t.text()}).then(function(t){var e=document.createRange().createContextualFragment(t);i._tco&&i._tco.appendChild(e)})},t.prototype.attach=function(t){if(this._state===MicroState.LOADED){var e=t.getAttribute("u-is");if(e){var i=this._registry[e];i&&this.loadBehavior(t,i)}}else this._unloadedList.push(t)},t.prototype._setPlaceholders=function(t,e){var i=this;function n(t,e){for(var i in e)t=t.replace(new RegExp("\\$\\{"+i+"\\}","g"),e[i]);return t}if(t.nodeType===Node.TEXT_NODE)t.textContent&&(t.textContent=n(t.textContent,e));else if(t.nodeType==Node.ELEMENT_NODE){for(var o=t.attributes,s=0;s<o.length;s++){var r=o[s].value;0<=r.indexOf("${")&&(t[o[s].name]=o[s].value=n(r,e))}t.childNodes.forEach(function(t){i._setPlaceholders(t,e)})}},t.prototype.isVisible=function(t){var e=!1;if(0<t.offsetWidth&&0<t.offsetHeight){var i=t.getBoundingClientRect();e=i.top<=window.innerHeight&&0<=i.bottom}return e},t.prototype.loadDataImage=function(t){t.dataset.src&&this.isVisible(t)&&(t.src=t.dataset.src)},t.prototype.insertTemplate=function(t,e,i){var n=this,o=null;if(t&&e&&this._tco){var s=this._tco.querySelector('[u-control="'+e.toLowerCase()+'"]');s&&(o=s.cloneNode(!0)),o&&(o.params=i,this._setPlaceholders(o,i),t.appendChild(o),t.querySelectorAll("[data-src]:not([src])").forEach(function(t){return n.loadDataImage(t)}))}return o},t.prototype.loadBehavior=function(t,e){var i=e,n=t;if(t)if(e)if(n._attachedBehavior===e);else{if(t.attributes)for(var o=0;o<t.attributes.length;o++){var s=t.attributes[o];t[s.name]||(t[s.name]=s.value)}for(var r in i)"on_"==r.substr(0,3)?t.addEventListener(r.substr(3),i[r].bind(t),!1):"on"==r.substr(0,2)?t.addEventListener(r.substr(2),i[r].bind(t),!1):(null==i[r]||i[r].constructor!=Function)&&t[r]||(t[r]=i[r]);n._attachedBehavior=e,t.parentElement!==this._tco&&(n.connectedCallback(),this.List.push(t))}else console.error("loadBehavior: behavior argument is missing.");else console.error("loadBehavior: obj argument is missing.")},t.prototype.define=function(t,e){this._registry[t]=e},t.prototype.openModal=function(t,e){var i=document.getElementById("modal"),n=document.getElementById("modalContainer");i&&n&&(n.innerHTML="",n.style.width="",n.style.height="",console.log("empty:",n.getBoundingClientRect()),micro.insertTemplate(n,t,e),console.log("added:",n.getBoundingClientRect()),i.classList.remove("hidden"),console.log("visible:",n.getBoundingClientRect()))},t.prototype.closeModal=function(){var t=document.getElementById("modal"),e=document.getElementById("modalContainer");t&&e&&(t.classList.add("hidden"),e.innerHTML="")},t.prototype.onunload=function(t){for(var e in this.List){var i=this.List[e];i&&i.term&&i.term();for(var n=0;n<i.attributes.length;n++)i[i.attributes[n].name]=null}for(var e in this.List)delete this.List[e];this.List=[]},t}(),micro=new MicroRegistry,obs=new MutationObserver(function(t,e){for(var i=0,n=t;i<n.length;i++){n[i].addedNodes.forEach(function(t){t.getAttribute&&t.getAttribute("u-is")&&micro.attach(t)})}});obs.observe(document,{childList:!0,subtree:!0}),document.addEventListener("DOMContentLoaded",function(){window.addEventListener("scroll",function(){document.querySelectorAll("[data-src]:not([src])").forEach(function(t){return micro.loadDataImage(t)})})});var MicroControlClass=function(){function t(){}return t.prototype.connectedCallback=function(){},t}();function MicroControl(e){return function(t){return micro.define(e,new t),t}}var GenericWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.microid="",t.data={},t.subId=0,t.actions=[],t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.data={id:this.microid},this.subId=hub.subscribe(this.microid+"?*",this.newData.bind(this)),hub.replay(this.subId)},t.prototype.newData=function(t,e,i){if(e&&i){this.data[e]=i;var n=this.querySelector("img");n&&setAttr(n,"title",JSON.stringify(this.data,null,1).replace("{\n","").replace("\n}",""))}["span","div"].forEach(function(t){this.querySelectorAll(t+"[u-active='"+e+"']").forEach(function(t){var e=toBool(i);setAttr(t,"value",e?"1":"0"),setAttr(t,"title",e?"active":"not active"),t.classList.toggle("active",e)})},this),["h2","h4","span","button"].forEach(function(t){this.querySelectorAll(t+"[u-text='"+e+"']").forEach(function(t){t.textContent!=i&&(t.textContent=i)})},this),["input","select"].forEach(function(t){this.querySelectorAll(t+"[u-value='"+e+"']").forEach(function(t){t.value!=i&&(t.value=i||"")})},this),["button"].forEach(function(t){this.querySelectorAll(t+"[u-action='${"+e+"}']").forEach(function(t){setAttr(t,"u-action",i||"")})},this)},t.prototype.dispatchNext=function(){var t=this;if(this.actions){var e=this.actions.shift();e&&fetch(e).then(function(){0<t.actions.length?debounce(t.dispatchNext.bind(t))():updateAsap&&updateAsap()})}},t.prototype.dispatchAction=function(t,e){var i=this;null!==t&&null!==e&&(t.includes("/")?(t.replace("${v}",encodeURI(e)),t.split(",").forEach(function(t){return i.actions.push("/$board/"+t)})):this.actions.push("/$board"+this.microid+"?"+t+"="+encodeURI(e)),debounce(this.dispatchNext.bind(this))())},t.prototype.on_change=function(t){var e=t.target;this.dispatchAction(e.getAttribute("u-value"),e.value)},t.prototype.on_click=function(t){var e=t.target,i=e.getAttribute("u-action");e&&i&&this.dispatchAction(i,e.value),e.classList.contains("setconfig")&&micro.openModal("configelementdlg",this.data)},t=__decorate([MicroControl("generic")],t)}(MicroControlClass),ButtonWidgetClass=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.on_pointerdown=function(t){var e=t.target;e&&e.classList.contains("u-button")&&(e.classList.add("active"),this.dispatchAction("value","1"))},e.prototype.on_pointerup=function(t){var e=t.target;e.classList.contains("u-button")&&(e.classList.remove("active"),this.dispatchAction("value","0"))},e=__decorate([MicroControl("button")],e)}(GenericWidgetClass),DSTimeWidgetClass=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return __extends(t,i),t.prototype.isoDate=function(){function t(t){return(t<10?"0":"")+t}var e=new Date;return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},t.prototype.connectedCallback=function(){i.prototype.connectedCallback.call(this),this._nowObj=this.querySelector(".setnow"),window.setInterval(function(){this._nowObj&&setTextContent(this._nowObj,this.isoDate())}.bind(this),200)},t.prototype.on_click=function(t){var e=t.target;e&&e.classList.contains("setnow")?this.dispatchAction("time",this.isoDate()):i.prototype.on_click.call(this,t)},t=__decorate([MicroControl("dstime")],t)}(GenericWidgetClass),DisplayDotWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastValue=null,t._dispElem=null,t._elem=null,t._x=0,t._y=0,t._value=!1,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this._dispElem=document.querySelector("#panel .display"),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0)},t.prototype.updateDisp=function(t){this._dispElem&&(t&&!this._elem&&(this._elem=document.createElement("span"),this._dispElem.appendChild(this._elem)),this._elem&&(this._elem.className="dot",this._elem.style.top=this._y+"px",this._elem.style.left=this._x+"px",this._elem.classList.toggle("active",this._value)))},t.prototype.newValue=function(t,e,i){e&&i&&("active"!==e||this._elem?"value"===e?(this._value=toBool(i),this.updateDisp(!1)):"x"===e?(this._x=Number(i),this.updateDisp(!1)):"y"===e?(this._y=Number(i),this.updateDisp(!1)):console.log("key",e,i):this.updateDisp(!0))},t=__decorate([MicroControl("displaydot")],t)}(GenericWidgetClass),DisplayTextWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastValue=null,t._dispElem=null,t._dispGrid=1,t._elem=null,t._prefix="",t._postfix="",t}return __extends(t,e),t.prototype.connectedCallback=function(){if(e.prototype.connectedCallback.call(this),this._dispElem=document.querySelector("#panel .display"),this._dispElem){this._dispElem.getAttribute("grid")&&(this._dispGrid=Number(this._dispElem.getAttribute("grid")));var t=this._elem=document.createElement("span");t.className="text",t.style.top="0px",t.style.left="0px",this._dispElem.appendChild(t)}hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0)},t.prototype.newValue=function(t,e,i){if(e&&i&&this._elem)if("value"===e){var n=""+this._prefix+i+this._postfix;this._elem.innerHTML=n.replace(/ /g,"&nbsp;")}else"x"===e?this._elem.style.left=Number(i)*this._dispGrid*7/10+"px":"y"===e?this._elem.style.top=Number(i)*this._dispGrid+"px":"fontsize"===e?(this._elem.style.fontSize=i+"px",this._elem.style.lineHeight=i+"px",this._elem.style.height=i+"px"):"prefix"===e?this._prefix=i:"postfix"===e&&(this._postfix=i)},t=__decorate([MicroControl("displaytext")],t)}(GenericWidgetClass);function jsonParse(t,e){!function t(e,i,n,o){var s=i?e+"/"+i:e;if(s=s.replace("/[","["),Array.isArray(n))for(var r=0;r<n.length;r++)t(s,"["+r+"]",n[r],o);else if("object"==typeof n)for(var a in o(s,null,null),n)t(s,a,n[a],o);else o(e,i,String(n))}("","",t,e)}function jsonFind(t,e){"/"===e[0]&&(e=e.substr(1));for(var i=e.split("/");t&&0<i.length;){var n=i[0];t[n]||(t[n]={}),t=t[n],i.shift()}return t}var LogWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filename=null,t.lineSVGObj=null,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.lineSVGObj=this.querySelector("object"),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0)},t.prototype.loadData=function(){fetch(this.filename).then(function(t){return t.text()}).then(function(t){var e=/^\d{2,},\d+/,i=t.split("\n").filter(function(t){return t.match(e)});this.api.updateLineChartData(this.lChart,i.map(function(t){var e=t.split(",");return{x:e[0],y:e[1]}}))}.bind(this))},t.prototype.loadSVG=function(){var t=!1;if(this.lineSVGObj){var e=null;try{e=this.lineSVGObj.getSVGDocument()}catch(t){}e&&e.api&&(this.api=this.lineSVGObj.getSVGDocument().api,this.lChart=this.api.addLineChart(),this.api.addVAxis(),this.api.addHAxis(),this.loadData(),t=!0)}t||window.setTimeout(this.loadSVG.bind(this),1e3)},t.prototype.newValue=function(t,e,i){"filename"===e&&(this.filename=i,this.loadSVG())},t=__decorate([MicroControl("log")],t)}(GenericWidgetClass),NeoWidgetClass=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.x16=function(t){var e=Number(t).toString(16);return 1===e.length&&(e="0"+e),e},t.prototype.on_click=function(t){var e=t.srcElement;if("hueband"==e.className){var i="hsl("+Math.round(t.offsetX)+", 100%, 50%)";if(e.style.backgroundColor=i,document&&document.defaultView){var n=document.defaultView.getComputedStyle(e,null).backgroundColor,o=String(n).replace(/[^0-9,]/g,"").split(","),s="x"+this.x16(o[0])+this.x16(o[1])+this.x16(o[2]);this.dispatchAction("value",s)}}else r.prototype.on_click.call(this,t)},t=__decorate([MicroControl("neo")],t)}(GenericWidgetClass),PWMOutWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._range=255,t.lastValue=null,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),hub.subscribe(this.microid+"?*",this.newValue.bind(this))},t.prototype.newValue=function(t,e,i){if("range"==e)this._range=Number(i);else if("value"==e&&this.lastValue!==i){var n=this.querySelector(".ux-levelbar"),o=n.offsetHeight,s=o*Number(i)/this._range;o-1<s&&(s=o-1),s<1&&(s=1),n.style.borderBottomWidth=s+"px",this.lastValue=i}},t=__decorate([MicroControl("pwmout")],t)}(GenericWidgetClass),SliderWidgetClass=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t._handle=null,t._lastValue=-1,t._maxright=100,t._x=0,t._xOffset=0,t.unit=1,t.minvalue=0,t.maxvalue=255,t}return __extends(t,o),t.prototype.connectedCallback=function(){if(o.prototype.connectedCallback.call(this),this._handle=this.querySelector(".handle"),this._handle){var t=this._handle.parentElement,e=getComputedStyle(t);this._maxright=t.clientWidth-this._handle.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)}},t.prototype._adjustHandle=function(t){if(this._handle){var e=t-this.minvalue;e=Math.round(e*this._maxright/(this.maxvalue-this.minvalue)),e=Math.min(this._maxright,Math.max(0,e)),this._handle.style.left=e+"px"}},t.prototype.newData=function(t,e,i){if(o.prototype.newData.call(this,t,e,i),"value"==e){var n=Number(i);n!=this._lastValue&&(this._adjustHandle(n),this._lastValue=n)}else"min"==e?this.minvalue=Number(i):"max"==e?this.maxvalue=Number(i):"step"==e&&(this.unit=Number(i))},t.prototype.on_click=function(t){for(var e=t.srcElement;null!=e&&0==e.classList.length;)e=e.parentElement;null!=e&&(e.classList.contains("up")?this.dispatchAction("up","1"):e.classList.contains("down")?this.dispatchAction("down","1"):o.prototype.on_click.call(this,t))},t.prototype.on_mousedown=function(t){t.target==this._handle&&this.MoveStart(t)},t.prototype.MoveStart=function(t){this._xOffset=0;for(var e=this._handle.offsetParent;null!=e;)this._xOffset+=e.offsetLeft,e=e.offsetParent;this._x=t.clientX-(this._handle.offsetLeft+this._xOffset),this._moveFunc=this._onmousemove.bind(this),document.addEventListener("mousemove",this._moveFunc,!1),this._upFunc=this._onmouseup.bind(this),document.addEventListener("mouseup",this._upFunc,!1),t.cancelBubble=!0,t.returnValue=!1},t.prototype._onmousemove=function(t){var e=t.clientX-this._x-this._xOffset;e=Math.min(this._maxright,Math.max(0,e));var i=Math.round(e*(this.maxvalue-this.minvalue)/this._maxright+this.minvalue);i=Math.round(i/this.unit)*this.unit,this._adjustHandle(i),i!=this._lastValue&&(this._lastValue=i,this.dispatchAction("value",String(i)))},t.prototype._onmouseup=function(t){t=t||window.event,document.removeEventListener("mousemove",this._moveFunc),document.removeEventListener("mouseup",this._upFunc)},t.prototype.on_touchstart=function(t){t.targetTouches[0].target==this._handle&&console.log("TouchStart")},t=__decorate([MicroControl("slider")],t)}(GenericWidgetClass),SwitchWidgetClass=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.on_click=function(t){for(var e=this.querySelector(".u-switch"),i=t.srcElement;null!=i&&i!=this&&i!=e;)i=i.parentElement;i==e?this.dispatchAction("toggle","1"):n.prototype.on_click.call(this,t)},t=__decorate([MicroControl("switch")],t)}(GenericWidgetClass);function toBool(t){if(!t)return!1;switch(t.toLowerCase().trim()){case"true":case"yes":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(t)}}function toSeconds(t){return(t=t.toLowerCase()).endsWith("h")?60*parseInt(t,10)*60:t.endsWith("m")?60*parseInt(t,10):t.endsWith("s")?parseInt(t,10):t.includes(":")?(Date.parse("1.1.1970 "+t)-Date.parse("1.1.1970"))/1e3:Number(t)}function setTextContent(t,e){t.textContent!==e&&(t.textContent=e)}function setAttr(t,e,i){t.getAttribute(e)!==i&&t.setAttribute(e,i)}function changeConfig(t,e){var i="/config.json",n=JSON.parse(hub.read("config")),o=jsonFind(n,t);for(var s in e)e[s]?o[s]=e[s]:delete o[s];var r=new FormData;r.append(i,new Blob([JSON.stringify(n)],{type:"text/html"}),i);var a=new XMLHttpRequest;a.open("POST","/"),a.addEventListener("readystatechange",function(){4==this.readyState&&200<=this.status&&this.status<300&&alert("saved.")}),a.send(r)}function debounce(i,n){var o;return void 0===n&&(n=20),function(){var t=this,e=arguments;o&&clearTimeout(o),o=setTimeout(function(){o=0,i.apply(t,e)},n)}}function getHashParams(t){var i=__assign({},t);return window.location.hash.substr(1).split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),i}var TimerWidgetClass=function(r){function t(){var t=null!==r&&r.apply(this,arguments)||this;return t.wt=0,t.pt=0,t.ct=0,t.time=0,t}return __extends(t,r),t.prototype.newData=function(t,e,i){if(r.prototype.newData.call(this,t,e,i),"waittime"==e?this.wt=toSeconds(i):"pulsetime"==e?this.pt=toSeconds(i):"cycletime"==e?this.ct=toSeconds(i):"time"==e&&(this.time=toSeconds(i)),this.ct<this.wt+this.pt&&(this.ct=this.wt+this.pt),0<this.ct){var n=this.querySelector(".u-bar"),o=n.clientWidth/this.ct,s=n.querySelector(".pulse");s.style.left=Math.floor(this.wt*o)+"px",s.style.width=Math.floor(this.pt*o)+"px",n.querySelector(".current").style.width=Math.floor(this.time*o)+"px"}},t.prototype.on_click=function(t){if(t.target.classList.contains("save")){var i={};this.querySelectorAll("[u-value]").forEach(function(t){var e=t.getAttribute("u-value");e&&(i[e]=t.value)}),changeConfig(this.microid,i)}r.prototype.on_click.call(this,t)},t=__decorate([MicroControl("timer")],t)}(GenericWidgetClass),MicroHub=function(){function t(){this._registrations={},this._registrationsId=0,this._store={}}return t.prototype._findStoreObject=function(t){var e=this._store;"/"===t[0]&&(t=t.substr(1));for(var i=t.split("/");0<i.length&&e[i[0]];)e=e[i[0]],i.shift();for(;0<i.length&&i[0];)e=e[i[0]]={},i.shift();return e},t.prototype.pPath=function(t){"/"===t[0]&&(t=t.substr(1));var e=t.split("/");return e.slice(0,e.length-1).join("/")},t.prototype.pKey=function(t){var e=t.split("/");return e[e.length-1]},t.prototype.read=function(t){return this._findStoreObject(this.pPath(t))[this.pKey(t)]},t.prototype.write=function(t,e){this._findStoreObject(this.pPath(t))[this.pKey(t)]=e},t.prototype.subscribe=function(t,e,i){void 0===i&&(i=!1);var n=this._registrationsId,o="^"+t.toLocaleLowerCase().replace(/(\[|\]|\/|\?)/g,"\\$1").replace(/\*\*/g,"\\S{0,}").replace(/\*/g,"[^/?]*")+"$",s={id:n,match:RegExp(o),callback:e};return this._registrations[n]=s,this._registrationsId++,i&&jsonParse(this._store,function(t,e,i){var n=t+(e?"?"+e:"");n&&(n=n.toLocaleLowerCase()).match(s.match)&&s.callback(t,e?e.toLowerCase():null,i)}.bind(this)),n},t.prototype.unsubscribe=function(t){delete this._registrations[t]},t.prototype.replay=function(t){var o=this._registrations[t];o&&jsonParse(this._store,function(t,e,i){var n=t+(e?"?"+e:"");n&&(n=n.toLocaleLowerCase()).match(o.match)&&o.callback(t,e?e.toLowerCase():null,i)}.bind(this))},t.prototype.publishObj=function(t){jsonParse(t,function(t,e,i){this.publishValue(t,e?e.toLowerCase():"",i||"")}.bind(this))},t.prototype.publishValue=function(e,i,n){var o=e+(i?"?"+i:"");if(o){if(i)this._findStoreObject(e)[i]=n;o=o.toLocaleLowerCase(),Object.values(this._registrations).forEach(function(t){o.match(t.match)&&t.callback(e,i,n)})}},t.prototype.onunload=function(t){for(var e in this._registrations)delete this._registrations[e]},t}(),hub=new MicroHub;window.addEventListener("unload",hub.onunload.bind(hub),!1);
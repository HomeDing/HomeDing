"use strict";var MicroState,__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,n){var s,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;0<=a;a--)(s=t[a])&&(r=(o<3?s(r):3<o?s(e,i,r):s(e,i))||r);return 3<o&&r&&Object.defineProperty(e,i,r),r},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};!function(t){t[t.PREP=1]="PREP",t[t.INIT=2]="INIT",t[t.LOADED=3]="LOADED"}(MicroState=MicroState||{});var MicroRegistry=function(){function t(){this._tco=null,this._registry={},this._state=MicroState.PREP,this._unloadedList=[],this.List=[],window.addEventListener("load",this.init.bind(this)),window.addEventListener("unload",this.onunload.bind(this))}return t.prototype.loadFile=function(t){var i=this;return fetch(t).then(function(t){return t.text()}).then(function(t){var e=document.createRange().createContextualFragment(t);i._tco&&i._tco.appendChild(e)})},t.prototype.attach=function(t){var e,i;this._state===MicroState.LOADED?!(e=t.getAttribute("u-is"))||(i=this._registry[e])&&this.loadBehavior(t,i):this._unloadedList.push(t)},t.prototype._setPlaceholders=function(t,i){var e=this;function n(t){for(var e in i)t=t.replace(new RegExp("\\$\\{"+e+"\\}","g"),i[e]);return t}if(t.nodeType===Node.TEXT_NODE)t.textContent&&(t.textContent=n(t.textContent));else if(t.nodeType===Node.ELEMENT_NODE){for(var s=t.attributes,o=0;o<s.length;o++){var r=s[o].value;0<=r.indexOf("${")&&(t[s[o].name]=s[o].value=n(r))}t.childNodes.forEach(function(t){e._setPlaceholders(t,i)})}},t.prototype.isVisible=function(t){var e,i=!1;return 0<t.offsetWidth&&0<t.offsetHeight&&(i=(e=t.getBoundingClientRect()).top<=window.innerHeight&&0<=e.bottom),i},t.prototype.loadDataImage=function(t){t.dataset.src&&this.isVisible(t)&&(t.src=t.dataset.src)},t.prototype.insertTemplate=function(t,e,i){var n,s=this,o=null;return t&&e&&this._tco&&((n=this._tco.querySelector('[u-control="'+e.toLowerCase()+'"]'))&&(o=n.cloneNode(!0)),o&&(o.params=i,this._setPlaceholders(o,i),t.appendChild(o),t.querySelectorAll("[data-src]:not([src])").forEach(function(t){return s.loadDataImage(t)}))),o},t.prototype.loadBehavior=function(t,e){var i=e,n=t;if(t)if(e){if(n._attachedBehavior!==e){if(t.attributes)for(var s=0;s<t.attributes.length;s++){var o=t.attributes[s];t[o.name]||(t[o.name]=o.value)}for(var r in i)"on_"===r.substr(0,3)?t.addEventListener(r.substr(3),i[r].bind(t),!1):"on"===r.substr(0,2)?t.addEventListener(r.substr(2),i[r].bind(t),!1):(null==i[r]||i[r].constructor!==Function)&&t[r]||(t[r]=i[r]);n._attachedBehavior=e,t.parentElement!==this._tco&&(n.connectedCallback(),this.List.push(t))}}else;else;},t.prototype.define=function(t,e){this._registry[t]=e},t.prototype.onunload=function(t){for(var e in this.List){var i=this.List[e];i&&i.term&&i.term();for(var n=0;n<i.attributes.length;n++)i[i.attributes[n].name]=null}for(var e in this.List)delete this.List[e];this.List=[]},t.prototype.init=function(){var t;this._state=MicroState.INIT,this._tco=document.getElementById("u-templates"),this._tco||((t=document.createElement("div")).id="u-templates",this._tco=document.body.appendChild(t)),"complete"===document.readyState?this.init2():document.addEventListener("readystatechange",this.init2)},t.prototype.init2=function(){var n=this;"complete"===document.readyState&&(this._state=MicroState.LOADED,this._unloadedList.forEach(function(t){var e,i=t.getAttribute("u-is");i&&((e=n._registry[i])&&n.loadBehavior(t,e),n.List.push(t))}),this._unloadedList=[])},t}(),micro=new MicroRegistry,obs=new MutationObserver(function(t,e){for(var i=0,n=t;i<n.length;i++){n[i].addedNodes.forEach(function(t){t.getAttribute&&t.getAttribute("u-is")&&micro.attach(t)})}});obs.observe(document,{childList:!0,subtree:!0}),document.addEventListener("DOMContentLoaded",function(){window.addEventListener("scroll",function(){document.querySelectorAll("[data-src]:not([src])").forEach(function(t){return micro.loadDataImage(t)})})});var MicroControlClass=function(){function t(){}return t.prototype.connectedCallback=function(){},t}();function MicroControl(e){return function(t){return micro.define(e,new t),t}}var GenericWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.microid="",t.data={},t.subId=0,t.actions=[],t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.data={id:this.microid},this.subId=hub.subscribe(this.microid+"?*",this.newData.bind(this)),hub.replay(this.subId)},t.prototype.newData=function(t,e,i){var n;e&&i&&(this.data[e]=i,(n=this.querySelector("img"))&&setAttr(n,"title",JSON.stringify(this.data,null,1).replace("{\n","").replace("\n}",""))),["span","div"].forEach(function(t){this.querySelectorAll(t+"[u-active='"+e+"']").forEach(function(t){var e=toBool(i);setAttr(t,"value",e?"1":"0"),setAttr(t,"title",e?"active":"not active"),t.classList.toggle("active",e)})},this),["h2","h4","span","button"].forEach(function(t){this.querySelectorAll(t+"[u-text='"+e+"']").forEach(function(t){t.textContent!==i&&(t.textContent=i)})},this),["input","select"].forEach(function(t){this.querySelectorAll(t+"[u-value='"+e+"']").forEach(function(t){t.value!==i&&(t.value=i||"")})},this),["button"].forEach(function(t){this.querySelectorAll(t+"[u-action='${"+e+"}']").forEach(function(t){setAttr(t,"u-action",i||"")})},this)},t.prototype.dispatchNext=function(){var t,e=this;!this.actions||(t=this.actions.shift())&&fetch(t).then(function(){0<e.actions.length?debounce(e.dispatchNext.bind(e))():updateAsap&&updateAsap()})},t.prototype.dispatchAction=function(t,e){var i=this;null!==t&&null!==e&&(t.includes("/")?(t.replace("${v}",encodeURI(e)),t.split(",").forEach(function(t){return i.actions.push("/$board/"+t)})):this.actions.push("/$board"+this.microid+"?"+t+"="+encodeURI(e)),debounce(this.dispatchNext.bind(this))())},t.prototype.showSys=function(){return toBool(getHashParams({sys:!1}).sys)},t.prototype.on_change=function(t){var e=t.target;this.dispatchAction(e.getAttribute("u-value"),e.value)},t.prototype.on_click=function(t){var e=t.target,i=e.getAttribute("u-action");e&&i&&this.dispatchAction(i,e.value),e.classList.contains("setconfig")?modal.open("configelementdlg",this.data):"H3"===e.tagName&&modal.openFocus(this)},__decorate([MicroControl("generic")],t)}(MicroControlClass),ButtonWidgetClass=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.on_pointerdown=function(t){var e=t.target;e&&e.classList.contains("u-button")&&(e.classList.add("active"),this.dispatchAction("value","1"))},e.prototype.on_pointerup=function(t){var e=t.target;e.classList.contains("u-button")&&(e.classList.remove("active"),this.dispatchAction("value","0"))},__decorate([MicroControl("button")],e)}(GenericWidgetClass),DSTimeWidgetClass=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return __extends(t,i),t.prototype.isoDate=function(){function t(t){return(t<10?"0":"")+t}var e=new Date;return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},t.prototype.connectedCallback=function(){i.prototype.connectedCallback.call(this),this._nowObj=this.querySelector(".setnow"),window.setInterval(function(){this._nowObj&&setTextContent(this._nowObj,this.isoDate())}.bind(this),200)},t.prototype.on_click=function(t){var e=t.target;e&&e.classList.contains("setnow")?this.dispatchAction("time",this.isoDate()):i.prototype.on_click.call(this,t)},__decorate([MicroControl("dstime")],t)}(GenericWidgetClass),DisplayDotWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastValue=null,t._dispElem=null,t._elem=null,t._x=0,t._y=0,t._value=!1,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this._dispElem=document.querySelector("#panel .display"),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0),this.showSys()||(this.style.display="none")},t.prototype.updateDisp=function(t){this._dispElem&&(t&&!this._elem&&(this._elem=document.createElement("span"),this._dispElem.appendChild(this._elem)),this._elem&&(this._elem.className="dot",this._elem.style.top=this._y+"px",this._elem.style.left=this._x+"px",this._elem.classList.toggle("active",this._value)))},t.prototype.newValue=function(t,e,i){e&&i&&("active"!==e||this._elem?"value"===e?(this._value=toBool(i),this.updateDisp(!1)):"x"===e?(this._x=Number(i),this.updateDisp(!1)):"y"===e&&(this._y=Number(i),this.updateDisp(!1)):this.updateDisp(!0))},__decorate([MicroControl("displaydot")],t)}(GenericWidgetClass),DisplayLineWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._dispElem=null,t._elem=null,t._x0=0,t._x1=0,t._y0=0,t._y1=0,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this._dispElem=document.querySelector("#panel .display"),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0),this.showSys()||(this.style.display="none")},t.prototype.updateDisp=function(){this._dispElem&&(this._elem||(this._elem=document.createElement("span"),this._dispElem.appendChild(this._elem)),this._elem&&(this._elem.className="line",this._elem.style.top=this._y0+"px",this._elem.style.left=this._x0+"px",this._elem.style.width=this._x1-this._x0+"px",this._elem.style.height=this._y1-this._y0+"px"))},t.prototype.newValue=function(t,e,i){e&&i&&(null!=this["_"+e]&&(this["_"+e]=i),this.updateDisp())},__decorate([MicroControl("displayline")],t)}(GenericWidgetClass),DisplayTextWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastValue=null,t._dispElem=null,t._grid=1,t._elem=null,t._prefix="",t._postfix="",t}return __extends(t,e),t.prototype.connectedCallback=function(){var t;e.prototype.connectedCallback.call(this),this._dispElem=document.querySelector("#panel .display"),this._dispElem&&(this._dispElem.getAttribute("grid")&&(this._grid=Number(this._dispElem.getAttribute("grid"))),(t=this._elem=document.createElement("span")).className="text",t.style.top="0px",t.style.left="0px",this._dispElem.appendChild(t)),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0),this.showSys()||(this.style.display="none")},t.prototype.newValue=function(t,e,i){var n,s;e&&i&&this._elem&&("value"===e?(n=""+this._prefix+i+this._postfix,this._elem.innerHTML=n.replace(/ /g,"&nbsp;")):"x"===e?(s=Number(i)*this._grid,this._elem.style.left=(1<this._grid?s:7*s/10)+"px"):"y"===e?this._elem.style.top=Number(i)*this._grid+"px":"fontsize"===e?(this._elem.style.fontSize=i+"px",this._elem.style.lineHeight=i+"px",this._elem.style.height=i+"px"):"prefix"===e?this._prefix=i:"postfix"===e&&(this._postfix=i))},__decorate([MicroControl("displaytext")],t)}(GenericWidgetClass);function jsonParse(t,a){!function t(e,i,n){var s=(s=i?e+"/"+i:e).replace("/[","[");if(Array.isArray(n))for(var o=0;o<n.length;o++)t(s,"["+o+"]",n[o]);else if("object"==typeof n)for(var r in a(s,null,null),n)t(s,r,n[r]);else a(e,i,String(n))}("","",t)}function jsonFind(t,e){"/"===e[0]&&(e=e.substr(1));for(var i=e.split("/");t&&0<i.length;){var n=i[0];t[n]||(t[n]={}),t=t[n],i.shift()}return t}var LogWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filename=null,t.lineSVGObj=null,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.lineSVGObj=this.querySelector("object"),hub.subscribe(this.microid+"?*",this.newValue.bind(this),!0)},t.prototype.loadData=function(){fetch(this.filename).then(function(t){return t.text()}).then(function(t){var e=/^\d{2,},\d+/,i=t.split("\n").filter(function(t){return t.match(e)});this.api.updateLineChartData(this.lChart,i.map(function(t){var e=t.split(",");return{x:e[0],y:e[1]}}))}.bind(this))},t.prototype.loadSVG=function(){var t=!1;if(this.lineSVGObj){var e=null;try{e=this.lineSVGObj.getSVGDocument()}catch(t){}e&&e.api&&(this.api=this.lineSVGObj.getSVGDocument().api,this.lChart=this.api.addLineChart(),this.api.addVAxis(),this.api.addHAxis(),this.loadData(),t=!0)}t||window.setTimeout(this.loadSVG.bind(this),1e3)},t.prototype.newValue=function(t,e,i){"filename"===e&&(this.filename=i,this.loadSVG())},__decorate([MicroControl("log")],t)}(GenericWidgetClass),ModalDialogClass=function(){function t(){this._isOpen=!1,this._focusStyle=null,this._mObj=null,this._cObj=null;var t=this;window.addEventListener("load",function(){t._mObj=document.getElementById("modal"),t._cObj=document.getElementById("modalContainer")})}return t.prototype.isOpen=function(){return this._isOpen},t.prototype.open=function(t,e){this._mObj&&this._cObj&&(this._cObj.innerHTML="",this._cObj.style.width="",this._cObj.style.height="",micro.insertTemplate(this._cObj,t,e),this._mObj.classList.remove("hidden"),this._isOpen=!0)},t.prototype.openFocus=function(t){var e,i,n,s,o,r;!this._isOpen&&t&&t.parentElement&&this._mObj&&this._cObj&&(this._focusObj=t,this._focusStyle=t.getAttribute("style"),e=t.getBoundingClientRect(),(i=t.cloneNode(!1)).style.width=e.width+"px",i.style.height=e.height+"px",t.parentElement.insertBefore(i,t),this._placeholderObj=i,t.classList.add("modalObject"),t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",this._cObj.innerHTML="",this._cObj.style.width="",this._cObj.style.height="",n=2,n=Math.min(2,(window.innerWidth-64)/e.width),n=Math.min(n,(window.innerWidth-64)/e.height),s=Math.floor(e.width*n)+"px",o=Math.floor(e.height*n)+"px",(i=document.createElement("div")).style.width=s,i.style.height=o,this._cObj.appendChild(i),r=i.getBoundingClientRect(),this._mObj.classList.remove("hidden"),t.style.margin="0",t.style.top=r.top+"px",t.style.left=r.left+"px",t.style.width=s,t.style.height=o,this._isOpen=!0)},t.prototype.close=function(){this._mObj&&this._cObj&&(this._mObj.classList.add("hidden"),this._focusObj&&this._placeholderObj&&this._placeholderObj.parentElement&&(this._focusObj.setAttribute("style",this._focusStyle||""),this._focusObj.classList.remove("modalObject"),this._placeholderObj.parentElement.removeChild(this._placeholderObj)),this._cObj.innerHTML="",this._isOpen=!1)},t}(),modal=new ModalDialogClass,NeoWidgetClass=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.x16=function(t){var e=Number(t).toString(16);return 1===e.length&&(e="0"+e),e},t.prototype.on_click=function(t){var e,i,n,s,o=t.srcElement;"hueband"===o.className?(e="hsl("+Math.round(t.offsetX)+", 100%, 50%)",o.style.backgroundColor=e,document&&document.defaultView&&(i=document.defaultView.getComputedStyle(o,null).backgroundColor,n=String(i).replace(/[^0-9,]/g,"").split(","),s="x"+this.x16(n[0])+this.x16(n[1])+this.x16(n[2]),this.dispatchAction("value",s))):r.prototype.on_click.call(this,t)},__decorate([MicroControl("neo")],t)}(GenericWidgetClass),PWMOutWidgetClass=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._range=255,t.lastValue=null,t}return __extends(t,e),t.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),hub.subscribe(this.microid+"?*",this.newValue.bind(this))},t.prototype.newValue=function(t,e,i){var n,s,o;"range"===e?this._range=Number(i):"value"===e&&this.lastValue!==i&&((s=(n=this.querySelector(".ux-levelbar")).offsetHeight)-1<(o=s*Number(i)/this._range)&&(o=s-1),o<1&&(o=1),n.style.borderBottomWidth=o+"px",this.lastValue=i)},__decorate([MicroControl("pwmout")],t)}(GenericWidgetClass),SliderWidgetClass=function(s){function t(){var t=null!==s&&s.apply(this,arguments)||this;return t._handle=null,t._lastValue=-1,t._maxright=100,t._x=0,t._xOffset=0,t.unit=1,t.minvalue=0,t.maxvalue=255,t}return __extends(t,s),t.prototype.connectedCallback=function(){var t,e;this._handle=this.querySelector(".handle"),s.prototype.connectedCallback.call(this),this._handle&&(t=this._handle.parentElement,e=getComputedStyle(t),this._maxright=t.clientWidth-this._handle.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight))},t.prototype._adjustHandle=function(t){var e;this._handle&&(e=t-this.minvalue,e=Math.round(e*this._maxright/(this.maxvalue-this.minvalue)),e=Math.min(this._maxright,Math.max(0,e)),this._handle.style.left=e+"px")},t.prototype.newData=function(t,e,i){var n;s.prototype.newData.call(this,t,e,i),"value"===e?(n=Number(i))!==this._lastValue&&(this._adjustHandle(n),this._lastValue=n):"min"===e?this.minvalue=Number(i):"max"===e?this.maxvalue=Number(i):"step"===e&&(this.unit=Number(i))},t.prototype.on_click=function(t){for(var e=t.srcElement;null!=e&&0===e.classList.length;)e=e.parentElement;null!=e&&(e.classList.contains("up")?this.dispatchAction("up","1"):e.classList.contains("down")?this.dispatchAction("down","1"):s.prototype.on_click.call(this,t))},t.prototype.on_mousedown=function(t){t.target===this._handle&&this.MoveStart(t)},t.prototype.MoveStart=function(t){this._xOffset=0;for(var e=this._handle.offsetParent;null!=e;)this._xOffset+=e.offsetLeft,e=e.offsetParent;this._x=t.clientX-(this._handle.offsetLeft+this._xOffset),this._moveFunc=this._onmousemove.bind(this),document.addEventListener("mousemove",this._moveFunc,!1),this._upFunc=this._onmouseup.bind(this),document.addEventListener("mouseup",this._upFunc,!1),t.cancelBubble=!0,t.returnValue=!1},t.prototype._onmousemove=function(t){var e=t.clientX-this._x-this._xOffset,e=Math.min(this._maxright,Math.max(0,e)),i=Math.round(e*(this.maxvalue-this.minvalue)/this._maxright+this.minvalue),i=Math.round(i/this.unit)*this.unit;this._adjustHandle(i),i!==this._lastValue&&(this._lastValue=i,this.dispatchAction("value",String(i)))},t.prototype._onmouseup=function(t){t=t||window.event,document.removeEventListener("mousemove",this._moveFunc),document.removeEventListener("mouseup",this._upFunc)},t.prototype.on_touchstart=function(t){t.targetTouches[0].target;this._handle},__decorate([MicroControl("slider")],t)}(GenericWidgetClass),SwitchWidgetClass=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.on_click=function(t){for(var e=this.querySelector(".u-switch"),i=t.srcElement;null!==i&&i!==this&&i!==e;)i=i.parentElement;i===e?this.dispatchAction("toggle","1"):n.prototype.on_click.call(this,t)},__decorate([MicroControl("switch")],t)}(GenericWidgetClass);function toBool(t){if(!t)return!1;switch(t.toLowerCase().trim()){case"true":case"yes":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(t)}}function toSeconds(t){return(t=t.toLowerCase()).endsWith("h")?60*parseInt(t,10)*60:t.endsWith("m")?60*parseInt(t,10):t.endsWith("s")?parseInt(t,10):t.includes(":")?(Date.parse("1.1.1970 "+t)-Date.parse("1.1.1970"))/1e3:Number(t)}function setTextContent(t,e){t.textContent!==e&&(t.textContent=e)}function setAttr(t,e,i){t.getAttribute(e)!==i&&t.setAttribute(e,i)}function changeConfig(t,e){var i="/env.json",n=JSON.parse(hub.read("env")),s=jsonFind(n,t);for(var o in 0===Object.keys(s).length&&(i="/config.json",s=jsonFind(n=JSON.parse(hub.read("config")),t)),e)e[o]?s[o]=e[o]:delete s[o];var r=new FormData;r.append(i,new Blob([JSON.stringify(n)],{type:"text/html"}),i);var a=new XMLHttpRequest;a.open("POST","/"),a.addEventListener("readystatechange",function(){4===this.readyState&&200<=this.status&&this.status<300&&alert("saved.")}),a.send(r)}function debounce(i,n){var s;return void 0===n&&(n=20),function(){var t=this,e=arguments;s&&clearTimeout(s),s=setTimeout(function(){s=0,i.apply(t,e)},n)}}function getHashParams(t){var i=__assign({},t);return window.location.hash.substr(1).split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),i}var TimerWidgetClass=function(r){function t(){var t=null!==r&&r.apply(this,arguments)||this;return t.wt=0,t.pt=0,t.ct=0,t.time=0,t}return __extends(t,r),t.prototype.newData=function(t,e,i){var n,s,o;r.prototype.newData.call(this,t,e,i),"waittime"===e?this.wt=toSeconds(i):"pulsetime"===e?this.pt=toSeconds(i):"cycletime"===e?this.ct=toSeconds(i):"time"===e&&(this.time=toSeconds(i)),this.ct<this.wt+this.pt&&(this.ct=this.wt+this.pt),0<this.ct&&(s=(n=this.querySelector(".u-bar")).clientWidth/this.ct,(o=n.querySelector(".pulse")).style.left=Math.floor(this.wt*s)+"px",o.style.width=Math.floor(this.pt*s)+"px",n.querySelector(".current").style.width=Math.floor(this.time*s)+"px")},t.prototype.on_click=function(t){var i;t.target.classList.contains("save")&&(i={},this.querySelectorAll("[u-value]").forEach(function(t){var e=t.getAttribute("u-value");e&&(i[e]=t.value)}),changeConfig(this.microid,i)),r.prototype.on_click.call(this,t)},__decorate([MicroControl("timer")],t)}(GenericWidgetClass),MicroHub=function(){function t(){this._registrations={},this._registrationsId=0,this._store={}}return t.prototype.read=function(t){return this._findStoreObject(this.pPath(t))[this.pKey(t)]},t.prototype.write=function(t,e){this._findStoreObject(this.pPath(t))[this.pKey(t)]=e},t.prototype.subscribe=function(t,e,i){void 0===i&&(i=!1);var n=this._registrationsId,s="^"+t.toLocaleLowerCase().replace(/(\[|\]|\/|\?)/g,"\\$1").replace(/\*\*/g,"\\S{0,}").replace(/\*/g,"[^/?]*")+"$",o={id:n,match:RegExp(s),callback:e};return this._registrations[n]=o,this._registrationsId++,i&&jsonParse(this._store,function(t,e,i){var n=t+(e?"?"+e:"");n&&(n=n.toLocaleLowerCase()).match(o.match)&&o.callback(t,e?e.toLowerCase():null,i)}.bind(this)),n},t.prototype.unsubscribe=function(t){delete this._registrations[t]},t.prototype.replay=function(t){var s=this._registrations[t];s&&jsonParse(this._store,function(t,e,i){var n=t+(e?"?"+e:"");n&&(n=n.toLocaleLowerCase()).match(s.match)&&s.callback(t,e?e.toLowerCase():null,i)}.bind(this))},t.prototype.publishObj=function(t){jsonParse(t,function(t,e,i){this.publishValue(t,e?e.toLowerCase():"",i||"")}.bind(this))},t.prototype.publishValue=function(e,i,n){var s=e+(i?"?"+i:"");s&&(i&&(this._findStoreObject(e)[i]=n),s=s.toLocaleLowerCase(),Object.values(this._registrations).forEach(function(t){s.match(t.match)&&t.callback(e,i,n)}))},t.prototype.onunload=function(t){for(var e in this._registrations)delete this._registrations[e]},t.prototype._findStoreObject=function(t){var e=this._store;"/"===t[0]&&(t=t.substr(1));for(var i=t.split("/");0<i.length&&e[i[0]];)e=e[i[0]],i.shift();for(;0<i.length&&i[0];)e=e[i[0]]={},i.shift();return e},t.prototype.pPath=function(t){"/"===t[0]&&(t=t.substr(1));var e=t.split("/");return e.slice(0,e.length-1).join("/")},t.prototype.pKey=function(t){var e=t.split("/");return e[e.length-1]},t}(),hub=new MicroHub;window.addEventListener("unload",hub.onunload.bind(hub),!1);
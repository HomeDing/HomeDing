<dialog id='addElement'u-is='dialog'><h2>Add a new Element</h2><div class='u-close'u-action='close'></div><form is='form-json'method='dialog'><div class='form-grid'><label>Type:</label> <select name='type'required><option disabled='disabled'selected='selected'hidden value=''>Select Element...</option></select> <label>ID:</label> <input name='id'required pattern='[0-9a-z]+'placeholder='enter a name ...'maxlength='12'></div><div><button u-action='next:configElement'type='submit'style='float:right'>Next</button></div></form></dialog><dialog id='configElement'u-is='dialog'><h2><span u-text='type'></span>/<span u-text='id'></span> Configuration</h2><div class='u-close'u-action='close'></div><form is='form-json'method='dialog'><div class='form-grid'></div><div><button u-action='done'type='submit'style='float:right'>save</button></div></form></dialog><dialog id='action'u-is='dialog'><h2>Event Configuration</h2><div class='u-close'u-action='close'></div><form method='dialog'is='form-json'><div class='form-grid'><h4 class='wide'>on Event:</h4><label>Source:</label><input name='srcId'required> <label>Event:</label><select name='event'required></select><h4 class='wide'>send Action:</h4><label>Target:</label><select name='target'required></select> <label>Action:</label><select name='action'required></select> <label>Value:</label><input name='value'value='$v'required></div><div><button type='submit'u-action='return'style='float:right'>Save</button></div></form></dialog><script>function lowerKeys(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e.toLowerCase()]=n})),t}function getDefs(e){const t=e.split("/")[0];return uElements.defs[t]??{}}let d2=document.querySelector("dialog#addElement");d2.addEventListener("open",(e=>{var t=e.detail.form.querySelector("select[name=type]");t&&t.options.length<=1&&Object.keys(uElements.defs).forEach((function(e){var n=createHTMLElement(t,"option",{value:e});n.textContent=e,n.disabled=!uElements.impl.includes(e)}))}));let d3=document.querySelector("dialog#configElement");d3.addEventListener("open",(e=>{let t;const n='<svg class="icon"><use href="./icons.svg#$"></use></svg>',o=lowerKeys(e.detail.data),a=d3.querySelector(".form-grid");function r(e,r,c){createHTMLElement(a,"label").textContent=e+":";const i=createHTMLElement(a,"div",{class:"form-inline"});t=createHTMLElement(i,"label").innerHTML=n.replace("$",c?"start":"no");const s=createHTMLElement(i,"input",{name:e,style:"width:18ch"});o[e.toLowerCase()]&&(s.value=o[e.toLowerCase()]),(t=createHTMLElement(i,"label",{"u-action":"action"})).innerHTML=n.replace("$",r?"start":"no"),r&&t.setAttribute("_event",e)}a.innerHTML="",d3.setAttribute("_id",o.type+"/"+o.id);var c=getDefs(o.type);if(getDefs("element").properties.forEach((e=>r(e,!1,!1))),c.extends){const e=getDefs(c.extends);e?.properties&&e.properties.forEach((e=>r(e,!1,!1))),e?.events&&e.events.forEach((e=>r(e,!0,!1))),e?.actions&&e.actions.forEach((e=>r(e,!1,!0)))}c?.properties&&c.properties.forEach((e=>r(e,!1,!1))),c?.events&&c.events.forEach((e=>r(e,!0,!1))),c?.actions&&c.actions.forEach((e=>r(e,!1,!0)))})),d3.addEventListener("click",(e=>{let t,n=e.target;for(;n&&n!==this&&(t=n.getAttribute("u-action"),!t);)n=n.parentElement;"action"==t&&DialogClass.openModalForm("action",{srcId:d3.getAttribute("_id"),srcEvent:n.getAttribute("_event")},(function(e){d3.querySelector('input[name="'+n.getAttribute("_event")+'"]').value=`${e.target}?${e.action}=${e.value}`}))})),d3.addEventListener("submit",(e=>{const t=e.target,n=e.submitter;if(n&&t){"done"===n.getAttribute("u-action")&&changeConfig(d3.getAttribute("_id"),t.getJsonData())}}));let d4=document.querySelector("dialog#action");d4.addEventListener("open",(e=>{const t=e.detail.form,n=e.detail.data,o=t.querySelector("SELECT[name=action]"),a=t.querySelector("SELECT[name=target]"),r=t.querySelector("SELECT[name=event]");function c(){o.innerHTML="",o.value="",o.disabled=!1,createHTMLElement(o,"option",{disabled:!0,selected:!0,hidden:!0,value:""}).textContent="Select action...";const e=getDefs(a.value),t=[].concat(e.extends?getDefs(e.extends).actions:[],e.actions?e.actions:[]);t.forEach((e=>{createHTMLElement(o,"option",{value:e}).textContent=e})),1===t.length&&(o.selectedIndex=1)}a.innerHTML="",n.srcEvent?createHTMLElement(r,"option",{value:n.srcEvent}).textContent=n.srcEvent:function(){r.innerHTML="",r.value="",r.disabled=!1,createHTMLElement(r,"option",{disabled:!0,selected:!0,hidden:!0,value:""}).textContent="Select event...";const e=getDefs(n.srcId).events||[];e.forEach((e=>{createHTMLElement(r,"option",{value:e}).textContent=e})),1===e.length&&(r.selectedIndex=1)}(),n.tarId?(createHTMLElement(a,"option",{value:n.tarId}).textContent=n.tarId,a.selected=1,c()):function(){createHTMLElement(a,"option",{disabled:!0,selected:!0,hidden:!0,value:""}).textContent="Select target...";for(const e in uElements.config)for(const t in uElements.config[e]){const n=e+"/"+t;createHTMLElement(a,"option",{value:n}).textContent=n}}(),a.addEventListener("change",(e=>{c()}))}))</script>
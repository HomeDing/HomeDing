<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'><meta name='viewport'content='width=device-width,initial-scale=1,user-scalable=no'><title>IoT-IDE</title><link rel='icon'type='image/png'href='/favicon48.png'sizes='48x48'><link content-type='text/css'href='iotstyle.css'rel='stylesheet'><script src='micro.js'></script><style>#files{border:solid 1px #000;background-color:#fff;color:#000;font-size:1rem;overflow-y:scroll;width:100%;height:100%}#files>div{display:flex}#files>div:hover{background-color:#eee}.file-delete,.file-entry{cursor:pointer;font-family:'Courier New',Courier,monospace;padding:0 .1em;height:1.2em}#files>div div.file-entry{overflow:hidden;flex-grow:1}pre.code{display:block;margin:0;border:solid 1px #000;padding:.2em;font-family:Courier New,Courier,monospace;font-size:.75rem;line-height:1.2;color:#000;background-color:#fffff8;overflow-x:hidden;overflow-y:scroll;height:100%;width:100%}#dropzone{color:#000;background-color:#dd8;padding:.6rem;border:1px dashed #000}#progress{position:absolute;top:.6rem;right:.1rem;width:300px;height:1.4rem;border:.1rem solid #000;opacity:1;pointer-events:none;background-color:#fff}#progress.fadeout{transition-delay:2s;transition-property:opacity;transition-duration:1s;transition-timing-function:linear;opacity:0}#checker{min-width:3rem;text-align:center;border:2px solid silver;background-color:#eee}button.once{position:relative}button:disabled.once:after{content:'';position:absolute;height:.6em;width:.6em;left:50%;top:50%;border:.2em solid #203050;border-bottom-color:transparent;border-radius:50%;animation:1.5s linear infinite turn}@keyframes turn{0%{transform:translate(-50%,-50%) rotate(0turn)}100%{transform:translate(-50%,-50%) rotate(1turn)}}.grid-container{display:grid;height:100vh;grid-template-columns:minmax(32ch,max-content) minmax(32ch,auto);grid-template-rows:min-content min-content min-content 1fr;column-gap:.5rem}.grid-container>div{grid-column:1/-1}</style></head><body style='margin:0;padding:0'><div class='grid-container'style='padding:1rem'><progress id='progress'class='fadeout'max='1'value='0'></progress><div class='u-header'><svg class='icon'><use href='./icons.svg#ide'/></svg><h1>HomeDing IDE</h1><span style='flex-grow:1'></span><div id='dropzone'>Drop here.</div></div><div class='u-navbar'><a href='/'>Home</a> <a href='/board.htm'>Board</a> <a href='/microide.htm'>IDE</a> <a href='/log.htm'>Log</a> <span class='gap'></span> <button class='once'id='doReboot'>reboot</button></div><div style='grid-column:1'><h3 style='display:inline-block;margin:0'>Files</h3><button style='float:right'onclick='handleReloadFS()'>reload</button></div><div style='grid-column:2'><h3 style='display:inline-block;margin:0'>File: <span id='activeFile'></span></h3><button id='format'class='once secondary'style='float:right'>format</button> <span class='btn-group'style='float:right'><button class='once'onclick='handleSave()'>save</button> <label class='valid'id='checker'>ok</label></span></div><div id='files'style='grid-column:1;flex:1 1 auto;overflow:scroll'>...</div><pre style='grid-column:2'class='code'contenteditable id='content'autocomplete='off'autocorrect='off'autocapitalize='off'spellcheck='false'></pre></div><script>const filesObj=document.getElementById("files"),contentObj=document.getElementById("content"),progressObj=document.getElementById("progress"),activeFileObj=document.getElementById("activeFile"),checkerObj=document.getElementById("checker");let thisFile;function loadEntry(e){let t=getPath();const n=e.target.innerText,o=n.split(" ")[0].substring(1);contentObj.innerText="",n.endsWith(")")?fetch(o).then((function(e){return e.text()})).then((function(e){contentObj.innerText=e,activeFileObj.innerText=thisFile=o})):(".."===n?(t=t.split("/"),t.splice(t.length-2,1),t=t.join("/")):t=n+"/",activeFileObj.innerText=thisFile=t,location.hash=t)}function DelayPromise(e){return new Promise((function(t){setTimeout(t,e)}))}function handleDeleteFile(e){e.stopPropagation(),e.preventDefault();let t=e.target.parentElement.firstElementChild.innerText;t=t.split(" ")[0];window.confirm("Delete "+t+" ?")&&(fetch(t,{method:"DELETE"}),window.setTimeout(handleReloadFS,100))}function addEntry(e){const t=createHTMLElement(filesObj,"div",{class:"row nogutter"});t.addEventListener("click",loadEntry);const n=createHTMLElement(t,"div",{class:"col stretch file-entry"});if("dir"===e.type)n.innerText=n.title=e.name;else{n.innerText=n.title=e.name+" ("+e.size+")";const o=createHTMLElement(t,"div",{class:"col file-delete"});o.innerText="[X]",o.addEventListener("click",handleDeleteFile)}}function getPath(){let e="/";return location.hash.length>0&&(e=location.hash.substring(1)),e.endsWith("/")||(e+="/"),e}function handleReloadFS(){const e=getPath();fetch(`/api/list?path=${e}`).then((function(e){return e.json()})).then((function(t){t.sort((function(e,t){if(e.type&&!t.type)return-1;if(!e.type&&t.type)return 1;const n=e.name.toLowerCase(),o=t.name.toLowerCase();return n<o?-1:n>o?1:0})),filesObj.innerHTML="","/"!==e&&addEntry({name:"..",type:"dir"}),t.forEach((function(e){addEntry(e)}))}))}function dragHelper(e){e.stopPropagation(),e.preventDefault()}function startUpload(e,t,n){progressObj.classList.remove("fadeout");const o=new FormData,a=new Blob([n],{type:t});o.append(e,a,e);const r=new XMLHttpRequest;r.open("POST","/"),r.upload&&r.upload.addEventListener("progress",(function(e){progressObj.max=e.total,progressObj.value=e.loaded})),r.addEventListener("readystatechange",(function(e){4===r.readyState&&r.status>=200&&r.status<300&&(window.setTimeout(handleReloadFS,200),progressObj.classList.add("fadeout"))})),r.send(o)}function handleSave(){progressObj.value=0,progressObj.max=1,thisFile=window.prompt("Upload File:",thisFile),void 0!==thisFile&&startUpload(thisFile,"text/html",contentObj.innerText)}function drop(e){progressObj.classList.remove("fadeout"),progressObj.value=0,progressObj.max=1,e.stopPropagation(),e.preventDefault();const t=e.dataTransfer.files,n=new FormData,o=getPath();for(let e=0;e<t.length;e++)n.append("file",t[e],o+t[e].name);const a=new XMLHttpRequest;a.upload.addEventListener("progress",(function(e){progressObj.max=e.total,progressObj.value=e.loaded})),a.addEventListener("readystatechange",(function(e){4===a.readyState&&a.status>=200&&a.status<300&&(window.setTimeout(handleReloadFS,100),progressObj.classList.add("fadeout"))})),a.open("POST","/"),a.send(n)}contentObj.addEventListener("paste",(function(e){const t=window.getSelection();if(t.rangeCount){const n=e.clipboardData.getData("text/plain");t.deleteFromDocument(),t.getRangeAt(0).insertNode(document.createTextNode(n)),t.collapseToEnd(),e.preventDefault()}})),document.querySelector("#format").addEventListener("click",(e=>{if(activeFileObj.innerText.toLowerCase().endsWith(".json")){let e=contentObj.innerText,t=null;e=e.replace(/\}\s*\{/g,"},{"),e=e.replace(/\}\s*"/g,'},"'),e=e.replace(/"\s*\n\s*"/g,'","'),e=e.replace(/,\s*([\}\]])/g,"$1");try{t=JSON.parse(e),t&&"object"==typeof t&&(contentObj.innerText=JSON.stringify(t,null,2))}finally{}}}));const box=document.getElementById("dropzone");function jsonCheck(){if(activeFileObj.innerText.toLowerCase().endsWith(".json")){let e=null,t=contentObj.innerText;t.indexOf("Â ")>=0&&(contentObj.innerText=t=t.replace(/\u00A0/g," "));try{e=JSON.parse(t),e&&"object"==typeof e||(e=null)}catch(e){checkerObj.title=e.message}null!==e?(checkerObj.textContent="ok",checkerObj.className="valid",checkerObj.title=""):(checkerObj.textContent="no",checkerObj.className="invalid"),window.status=t.length+"--"+(null!==e)}else"--"!=checkerObj.textContent&&(checkerObj.textContent="--",checkerObj.className="")}function runOnce(){var e=this;this.disabled=!0,DelayPromise(90).then((function(){return fetch("/api/reboot")})).then((function(){return DelayPromise(90)})).finally((function(t){e.disabled=!1}))}box.addEventListener("dragenter",dragHelper,!1),box.addEventListener("dragover",dragHelper,!1),box.addEventListener("drop",drop,!1),window.addEventListener("DOMContentLoaded",handleReloadFS),window.addEventListener("hashchange",handleReloadFS),window.setInterval(jsonCheck,500);var resetObj=document.getElementById("doReboot");resetObj.addEventListener("click",runOnce)</script></body></html>